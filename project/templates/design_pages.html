{% extends "base.html" %}

{% block title %}Interface Design{% endblock %}

{% block styles %}
<style>
  .mock-status-bar {
    height: 24px;
    background: #fff;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    align-items: center;
    font-size: 10px;
    font-weight: 600;
  }

  .screen-content {
    flex: 1;
    overflow-y: auto;
    background: #fff;
  }
</style>
{% endblock %}

{% block content %}
<div class="design-container row g-0">
  <!-- Config -->
  <div class="col-lg-5 config-pane">
    <div class="mb-4">
        <h2 class="fw-bold">Copy & Content</h2>
        <p class="text-muted">Edit the messages customers see during their journey.</p>
    </div>

    <form method="POST">
      <div class="accordion accordion-flush" id="pagesAccordion">
        <!-- Order Confirmation -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConfirmation">
              Order Confirmation Page
            </button>
          </h2>
          <div id="collapseConfirmation" class="accordion-collapse collapse show" data-bs-parent="#pagesAccordion">
            <div class="accordion-body px-0">
              <label class="form-label small fw-bold text-muted">Thank You Message</label>
              <textarea name="thank_you_message" class="form-control mb-3" rows="3">{{ config.thank_you_message }}</textarea>
            </div>
          </div>
        </div>

        <!-- Order Status -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStatus">
              Live Status Updates
            </button>
          </h2>
          <div id="collapseStatus" class="accordion-collapse collapse" data-bs-parent="#pagesAccordion">
            <div class="accordion-body px-0">
              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="status_order_number" {% if config.status_order_number %}checked{% endif %}>
                <label class="form-check-label">Show Order Number</label>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="status_live_status" {% if config.status_live_status %}checked{% endif %}>
                <label class="form-check-label">Enable Live Progress Bar</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100 mt-5 py-3 rounded-pill">
        Save All Pages
      </button>
    </form>
  </div>

  <!-- Preview -->
  <div class="col-lg-7 preview-pane">
    <div class="mobile-mockup">
      <div class="mock-status-bar">
        <span>9:41</span>
        <div>
          <i class="bi bi-reception-4"></i>
          <i class="bi bi-wifi mx-1"></i>
          <i class="bi bi-battery-full"></i>
        </div>
      </div>
      <div id="preview-screen" class="screen-content">
        <!-- Injected via JS -->
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const previewScreen = document.getElementById('preview-screen');
    const form = document.querySelector('form');

    const renderers = {
        'Confirmation': () => `
            <div class="text-center p-5">
                <div class="text-success mb-4" style="font-size: 4rem;"><i class="bi bi-check-circle-fill"></i></div>
                <h3 class="fw-bold">Order Received!</h3>
                <p class="text-muted mt-3">${form.querySelector('[name="thank_you_message"]').value || 'Thank you for your order!'}</p>
                <div class="mt-5 p-3 rounded-3 bg-light text-start">
                  <div class="small fw-bold text-muted text-uppercase mb-2">Next Steps</div>
                  <div class="small"><i class="bi bi-1-circle me-2"></i> Chef is checking your order</div>
                  <div class="small mt-2"><i class="bi bi-2-circle me-2"></i> We'll notify you when it's ready</div>
                </div>
            </div>
        `,
        'Status': () => `
            <div class="p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                  <h4 class="fw-bold mb-0">Track Order</h4>
                  <span class="badge bg-light text-dark border">#1234</span>
                </div>
                <div class="text-center py-4">
                  <div class="spinner-grow text-primary mb-3" role="status"></div>
                  <h5 class="fw-bold">Preparing your meal</h5>
                  <p class="text-muted small">Estimated: 12-15 mins</p>
                </div>
                <div class="progress" style="height: 6px;">
                  <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 45%; background-color: var(--primary-color);"></div>
                </div>
            </div>
        `
    };

    const updatePreview = () => {
        const active = document.querySelector('.accordion-collapse.show');
        const key = active.id.replace('collapse', '');
        previewScreen.innerHTML = renderers[key]();
    };

    document.querySelectorAll('.accordion-button').forEach(btn => btn.addEventListener('click', () => setTimeout(updatePreview, 350)));
    form.addEventListener('input', updatePreview);
    updatePreview();
});
</script>
{% endblock %}