{% extends "base.html" %}

{% block title %}Manage Staff{% endblock %}

{% block styles %}
<style>
    .staff-card {
        background: var(--surface);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        border: none;
    }
    
    .table thead th {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        border-top: none;
        padding: 1.25rem 1rem;
    }

    .table tbody td {
        padding: 1.25rem 1rem;
        border-bottom: 1px solid rgba(0,0,0,0.03);
    }

    .role-badge {
        font-weight: 600;
        font-size: 0.7rem;
        padding: 0.4em 0.8em;
        border-radius: 20px;
        background: var(--bg-light);
        color: var(--text-dark);
        border: 1px solid rgba(0,0,0,0.05);
    }

    .status-badge {
        font-size: 0.7rem;
        padding: 0.35em 0.75em;
        border-radius: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">Staff Management</h2>
            <p class="text-muted small mb-0">Manage your team members and their access levels.</p>
        </div>
        <button class="btn btn-primary rounded-pill px-4 shadow-sm" data-bs-toggle="modal" data-bs-target="#inviteStaffModal">
            <i class="bi bi-person-plus-fill me-2"></i>Invite Staff
        </button>
    </div>

    <div class="staff-card overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead>
                    <tr>
                        <th>Staff Member</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in staff %}
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="avatar-sm bg-primary-light text-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 38px; height: 38px;">
                                    {{ user.email[0]|upper }}
                                </div>
                                <span class="fw-bold">{{ user.email }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="role-badge">{{ user.role|title }}</span>
                        </td>
                        <td>
                            {% if user.password %}
                                <span class="badge bg-success-subtle text-success status-badge">Active</span>
                            {% else %}
                                <span class="badge bg-warning-subtle text-warning status-badge">Pending Invitation</span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <button class="btn btn-link text-danger p-0" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#deleteStaffModal" 
                                    data-delete-url="{{ url_for('admin.office_delete_staff', user_id=user.id) }}">
                                <i class="bi bi-trash fs-5"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center py-5 text-muted">
                            No staff members found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Invite Staff Modal -->
<div class="modal fade" id="inviteStaffModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-lg);">
            <div class="modal-header border-0 pb-0">
                <h5 class="fw-bold">Invite Team Member</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('admin.office_invite_staff') }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label smallest fw-bold text-muted text-uppercase">Email Address</label>
                        <input type="email" name="email" class="form-control bg-light border-0 py-2" placeholder="staff@example.com" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label smallest fw-bold text-muted text-uppercase">Role</label>
                        <select name="role" class="form-select bg-light border-0 py-2">
                            <option value="staff">Staff</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-primary w-100 rounded-pill py-2 fw-bold">Send Invite</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Staff Modal -->
<div class="modal fade" id="deleteStaffModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content border-0 shadow-lg" style="border-radius: var(--radius-lg);">
            <div class="modal-header border-0 pb-0">
                <h5 class="fw-bold">Remove Staff</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <p class="text-muted small">Are you sure you want to remove this user's access? This action cannot be undone.</p>
            </div>
            <div class="modal-footer border-0 pt-0">
                <form action="" method="POST" id="deleteStaffForm" class="w-100">
                    <button type="submit" class="btn btn-danger w-100 rounded-pill py-2 fw-bold">Confirm Removal</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('deleteStaffModal').addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var deleteUrl = button.getAttribute('data-delete-url');
        document.getElementById('deleteStaffForm').action = deleteUrl;
    });
</script>
{% endblock %}